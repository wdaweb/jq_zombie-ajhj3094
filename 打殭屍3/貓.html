<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #game {
      width: 1000px;
      height: 500px;
      border: 1px solid black;
      position: relative;
    }

    #cat {
      position: absolute;
      opacity: 0.5;
    }
  </style>
</head>

<body>
  <input type="button" value="開始" id="btn-start">
  <div id="game">
    <img id="cat" src="./cat.jpg" alt="" width="100px">
  </div>
  <script>
    const btnStart = document.getElementById('btn-start')
    const game = document.getElementById('game')
    const cat = document.getElementById('cat')

    const meow = new Audio()
    meow.src = './meow.mp3'

    let timer = 0
    let time = 0

    // 貓的位置
    let catpos = { top: '', left: '' }

    btnStart.onclick = () => {
      // 停用開始按鈕，避免重複點擊
      btnStart.disabled = true
      // 隨機移動貓咪
      // 貓咪的 top = 隨機 0 到 (遊戲區域高度 - 貓咪圖片高度) 取一個數字
      // 貓咪的 left = 隨機 0 到 (遊戲區域寬度 - 貓咪圖片寬度) 取一個數字
      catpos.top = Math.round(Math.random() * (game.offsetHeight - cat.offsetHeight))
      catpos.left = Math.round(Math.random() * (game.offsetWidth - cat.offsetWidth))
      cat.style.top = catpos.top + 'px'
      cat.style.left = catpos.left + 'px'

      time = 0
      timer = setInterval(() => {
        time++
        if (time % 10) {
          meow.play()
        }
      }, 100)
    }

    game.onmousemove = (event) => {
      // 滑鼠碰到貓時 event.target 會是貓，offsetX 和 offsetY 會變
      if (event.target !== game) return
      // 滑鼠座標
      const mousepos = { x: event.offsetX, y: event.offsetY }
      // 滑鼠與貓的水平和垂直距離
      const diff = { x: Math.abs(mousepos.x - catpos.left), y: Math.abs(mousepos.y - catpos.top) }
      // 算出距離
      const distance = Math.round(Math.sqrt(Math.pow(diff.x, 2) + Math.pow(diff.y, 2)))

      meow.volume = 1 - distance / Math.round(Math.sqrt(Math.pow(game.offsetWidth, 2) + Math.pow(game.offsetHeight, 2)))

    }

    cat.onclick = () => {
      // 檢查是不是遊戲中
      if (!btnStart.disabled) return

      clearInterval(timer)
      alert(`你花了 ${time / 10} 秒`)

      btnStart.disabled = false
    }
  </script>
</body>

</html>